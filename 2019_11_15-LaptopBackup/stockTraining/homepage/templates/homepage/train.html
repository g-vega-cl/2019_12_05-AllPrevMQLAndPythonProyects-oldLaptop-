{% load static %}
<!DOCTYPE html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	
	<link rel="stylesheet" type="text/css" href="{% static 'homepage/style.css' %}">
    <title>FxTrain</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>
<body style="">
	<div class="wrapper" style="">

		<main role = "main" class="container" id="mainSiteContainer" style="background-color: #FDFDFD; height: 100vh; border-left: 10px; border-right: 10px; border-style: solid; border-color: #BCBCBC;">
	  			<div class="row">
	  				<nav class="navbar navbar-expand-lg navbar-light" style="width: 100%">
			  <a class="navbar-brand" href="/" >
			  	<img src="{% static 'homepage/images/FxTrainLogoTransp.svg' %}" width="120" height="100" alt=""/>
			  </a>
			  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
			    <span class="navbar-toggler-icon"></span>
			  </button>

			  <div class="collapse navbar-collapse" id="navbarSupportedContent" style="margin-top: 10px;">
			    <ul class="navbar-nav mr-auto">
			      <li class="nav-item active">
			        <a class="nav-link" href="train"><h5 style="color: #333333">Train</h5> <span class="sr-only">(current)</span></a>
			      </li>
			      <li class="nav-item active">
			        <a class="nav-link" href="compete"><h5 style="color: #333333">Compete</h5> <span class="sr-only">(current)</span></a>
			      </li>
			      <li class="nav-item active">
			        <a class="nav-link" href="learn"><h5 style="color: #333333">Learn</h5> <span class="sr-only">(current)</span></a>
			      </li>
			      <li class="nav-item active">
			        <a class="nav-link" href="#"><h5 style="color: #333333">Pricing</h5> <span class="sr-only">(current)</span></a>
			      </li>
				  <li class="nav-item active">
			        <a class="nav-link" href="#"><h5 style="color: #333333">Help us!</h5><span class="sr-only">(current)</span></a>
			      </li>
	            <form action="#" onsubmit = "handle" class="search-form" style="margin-top: 3px;">
	                <div class="form-group has-feedback">
	            		<label for="search" class="sr-only">Search</label>
	            		<input type="text" class="form-control" name="search" id="search" placeholder="search">
	              		<span class="glyphicon glyphicon-search form-control-feedback"></span>
	            	</div>
	            </form>
				  <li class="nav-item active border-right" style="margin-top: 3px;">
			        <a class="nav-link" href="#"><h6>Sign In</h6><span class="sr-only">(current)</span></a>
			      </li>
				  <li class="nav-item active">
			        <button class="btn btn-outline-primary" type="submit" style="border-radius: 5px; border-color: #00B7C0;  margin-top: 2px; margin-left: 10px;">Register</button>
			      </li>

			    </ul>

			  </div>
			</nav>
	  			</div> 
	  	
			

			
				<div class="container" style="margin-bottom: 5px; background-color: #FDFDFD;">
					<div class="row" style=" color: #222222; margin-top: 70px; ">
						<div class="col-8" style="background-color: #FDFDFD; opacity: .9; margin: 0;">
							<button class="btn btn-outline-success" type="submit" style="border-radius: 5px; border-color: black; margin-left: 00px; width: 80px; margin-bottom: 2px;" id="IndexBuyButton" onclick="clickedToolBuyButton()">Buy</button>
							<button class="btn btn-outline-danger" type="submit" style="border-radius: 5px; border-color: black; width: 80px; margin-bottom: 2px;" id="IndexShortButton" onclick="clickedToolSellButton()">Short</button>
							<button class="btn btn-outline-Secondary" type="submit" style="border-radius: 5px; border-color: black; margin-left: 0px; width: 80px; margin-bottom: 2px;" id="IndexSellButton" onclick="">Sell</button>
							<button class="btn btn-outline-Secondary" type="submit" style="border-radius: 5px; border-color: black; width: 80px; margin-bottom: 2px;" id="IndexCoverButton" onclick="">Cover</button>						
							<button class="btn btn-outline-primary" type="submit" style="border-radius: 5px; border-color: black; width: 95px; margin-bottom: 2px;" id="IndexWaitButton" onclick="clickedToolWaitButton()">Wait-Hold</button>
							<div id="IndexChartToolDiv" style="height: 420px; margin-right: 0px; margin-top: 20px;"></div>
							<p id="IndexBalance" style="text-align: center; font-size: 20px;"> balance: 0 pips</p>
						</div>
						<div class="col-4">
							<table id="dtVerticalScrollTableFindScenario" class="table table-striped table-bordered" cellspacing="0" width="100%" >
								<thead>
									<tr>
										<th class="th-sm">Type</th>
										<th class="th-sm">Name</th>
										<th class="th-sm">Situation</th>
									</tr>
								</thead>	
								<tbody>
									<tr>
										<td>Currency</td>
										<td>USDCHF</td>
										<td>Trend</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				
				</div>
			</main>
		</div>


			    <!-- Optional JavaScript -->
	    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
	    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
	    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	    <script src="https://cdn.datatables.net/1.10.5/js/jquery.dataTables.min.js" type="text/javascript"></script>
	    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>


	    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
	    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
	</body>
</html>



<script>

var minimumHeight = window.matchMedia("(max-height: 580px)")
var minimumWidth = window.matchMedia("(max-width: 992px)")

function hideLargeWebsiteContent(minimumHeight, minimumWidth) {
  if (minimumHeight.matches) { // If media query matches
    document.getElementById("mainSiteContainer").style.display = "none";
  }else{
  	document.getElementById("mainSiteContainer").style.display = "block";	
  }

  if (minimumWidth.matches) { // If media query matches
    document.getElementById("mainSiteContainer").style.display = "none";
  }else{
  	document.getElementById("mainSiteContainer").style.display = "block";	
  }
}
var minimumHeightSite = window.matchMedia("(max-height: 580px)");
var minimumWidthSite = window.matchMedia("(max-width: 992px)");
minimumHeightSite.addListener(hideLargeWebsiteContent); // Attach listener function on state changes
minimumWidthSite.addListener(hideLargeWebsiteContent); // Attach listener function on state changes

function hideLargeWebMobileContent(minimumHeight, minimumWidth) {
  if (minimumHeight.matches) { // If media query matches
    document.getElementById("mainMobileContainer").style.display = "block";
  }else{
  	document.getElementById("mainMobileContainer").style.display = "none";	
  }

  if (minimumWidth.matches) { // If media query matches
    document.getElementById("mainMobileContainer").style.display = "block";
  }else{
  	document.getElementById("mainMobileContainer").style.display = "none";	
  }
}

var minimumHeightMobile = window.matchMedia("(max-height: 580px)")
var minimumWidthMobile = window.matchMedia("(max-width: 992px)")
minimumHeightMobile.addListener(hideLargeWebMobileContent) // Attach listener function on state changes
minimumWidthMobile.addListener(hideLargeWebMobileContent) // Attach listener function on state changes




//////////////////////////////////////////////////////////

var fullCloseArray = [{% for currency in all_currencies %} '{{ currency.Close }}' {% if not forloop.last %}, {% endif %} {% endfor %} ]
var fullHighArray = [{% for currency in all_currencies %} '{{ currency.High }}' {% if not forloop.last %}, {% endif %} {% endfor %} ]
var fullLowArray = [{% for currency in all_currencies %} '{{ currency.Low }}' {% if not forloop.last %}, {% endif %} {% endfor %} ]
var fullOpenArray = [{% for currency in all_currencies %} '{{ currency.Open }}' {% if not forloop.last %}, {% endif %} {% endfor %} ]
var fullMovingAverage = [{% for currency in all_currencies %} '{{ currency.MovingAverage }}' {% if not forloop.last %}, {% endif %} {% endfor %} ]

var startCandleCount = 200;
var currentCandleCount = startCandleCount + 55;
var maxCandleCount = currentCandleCount + 20;

var closeArray = fullCloseArray.slice(startCandleCount,currentCandleCount);
var highArray = fullHighArray.slice(startCandleCount,currentCandleCount);
var lowArray = fullLowArray.slice(startCandleCount,currentCandleCount);
var openArray = fullOpenArray.slice(startCandleCount,currentCandleCount);
var MovingAverage = fullMovingAverage.slice(startCandleCount,currentCandleCount);


function buildPlotly(){
	//JAVASCRIPT CHART. 
	var trace1 = {
	  
	  x: [0]*currentCandleCount, 
	  
	  close: closeArray, 
	  
	  decreasing: {line: {color: '#7F7F7F'}}, 
	  
	  high: highArray, 
	  
	  increasing: {line: {color: '#17BECF'}}, 
	  
	  line: {color: 'rgba(31,119,180,1)'}, 
	  
	  low: lowArray, 
	  
	  open: openArray, 
	  
	  type: 'candlestick', 
	  xaxis: 'x', 
	  yaxis: 'y',
	  hoverinfo: "none",
	  increasing: {line: {color: 'green'}},
  	  decreasing: {line: {color: 'red'}},
	};

	trace2 = {
	  line: {width: 1}, 
	  mode: 'lines', 
	  name: 'Moving Average', 
	  type: 'scatter', 
	  x: [0]*currentCandleCount,
	  y: MovingAverage, 
	  yaxis: 'y',
	  marker: {color: '#E377C2'},
	  hoverinfo: "none",
	};

	var plotlyData = [trace1,trace2];

	var layout = {
	  dragmode: 'zoom', 
	  margin: {
	    r: 10, 
	    t: 25, 
	    b: 40, 
	    l: 60
	  }, 
	  showlegend: false, 
	  xaxis: {
	    autorange: true, 
	    domain: [0, 1], 
	    type: 'category',
	    rangeslider: {
			 visible: false
		 }
	  }, 
	  dragmode: "pan",
	  yaxis: {
	    type: 'linear',
	    autorange: true
	  },
	  title: "Currency",
	};

	var config = {
		'scrollZoom': true,
	};

	Plotly.plot('IndexChartToolDiv', plotlyData, layout, config = config);

}

buildPlotly();

function getSpread(Symbol){ //REVISA ESTO BIEN
	if(Symbol == "USDCHF"){
		spread = 0.00020
	}

	return spread;
}


var balance = 0;
var lots = 0; //WILL LEAVE THIS UNTIL AFTER THE MVP
function clickedToolBuyButton(){
	var prevPrice = closeArray[closeArray.length -1];

	if (currentCandleCount <= maxCandleCount){
		currentCandleCount += 1;

		closeArray = fullCloseArray.slice(startCandleCount,currentCandleCount);
		highArray = fullHighArray.slice(startCandleCount,currentCandleCount);
		lowArray = fullLowArray.slice(startCandleCount,currentCandleCount);
		openArray = fullOpenArray.slice(startCandleCount,currentCandleCount);
		MovingAverage = fullMovingAverage.slice(startCandleCount,currentCandleCount);

		buildPlotly();

		var newPrice = closeArray[closeArray.length-1];

		balance += newPrice - prevPrice - getSpread("USDCHF");

		document.getElementById("IndexBalance").innerHTML = "Balance: " + 0 + " pips" + "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp " + "Equity: " + " " + balance.toFixed(5) + " pips" ;
	} else{
		document.getElementById("IndexBalance").innerHTML = "Your final balance was: " + balance.toFixed(5) + " pips";
	}

	//document.getElementById("MyElement").className = "MyClass"; To change Sell Button color



}

function clickedToolSellButton(){
	var prevPrice = closeArray[closeArray.length -1];

	if (currentCandleCount <= maxCandleCount){
		currentCandleCount += 1;

		closeArray = fullCloseArray.slice(startCandleCount,currentCandleCount);
		highArray = fullHighArray.slice(startCandleCount,currentCandleCount);
		lowArray = fullLowArray.slice(startCandleCount,currentCandleCount);
		openArray = fullOpenArray.slice(startCandleCount,currentCandleCount);
		MovingAverage = fullMovingAverage.slice(startCandleCount,currentCandleCount);

		buildPlotly();

		var newPrice = closeArray[closeArray.length-1];

		balance += prevPrice - newPrice - getSpread("USDCHF");

		document.getElementById("IndexBalance").innerHTML = "Balance: " + 0 + " pips" + "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp " + "Equity: " + " " + balance.toFixed(5) + " pips" ;
	} else{
		document.getElementById("IndexBalance").innerHTML = "Your final balance was: " + balance.toFixed(5) + " pips";
	}
}

function clickedToolWaitButton(){
	currentCandleCount += 1

	closeArray = fullCloseArray.slice(startCandleCount,currentCandleCount);
	highArray = fullHighArray.slice(startCandleCount,currentCandleCount);
	lowArray = fullLowArray.slice(startCandleCount,currentCandleCount);
	openArray = fullOpenArray.slice(startCandleCount,currentCandleCount);
	MovingAverage = fullMovingAverage.slice(startCandleCount,currentCandleCount);

	buildPlotly();
}





//////////////////////////////////////////////

scenarios = [
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Trend"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Brexit news"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Parliment desition"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "US FED statement"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Interest rate change"
	},
	{
		"type": "Stock",
		"name": "AAPL",
		"situation": "Earnings"
	},
	{
		"type": "Currency",
		"name": "EUR",
		"situation": "Brexit negotiations"
	},
	{
		"type": "Currency",
		"name": "AUD",
		"situation": "Trend"
	},
	{
		"type": "Currency",
		"name": "CHF",
		"situation": "Pattern"
	},
		{
		"type": "Currency",
		"name": "GBP",
		"situation": "Brexit news"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Parliment desition"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "US FED statement"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Interest rate change"
	},
	{
		"type": "Stock",
		"name": "AAPL",
		"situation": "Earnings"
	},
	{
		"type": "Currency",
		"name": "EUR",
		"situation": "Brexit negotiations"
	},
	{
		"type": "Currency",
		"name": "AUD",
		"situation": "Trend"
	},
	{
		"type": "Currency",
		"name": "CHF",
		"situation": "Pattern"
	},
		{
		"type": "Currency",
		"name": "GBP",
		"situation": "Brexit news"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Parliment desition"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "US FED statement"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Interest rate change"
	},
	{
		"type": "Stock",
		"name": "AAPL",
		"situation": "Earnings"
	},
	{
		"type": "Currency",
		"name": "EUR",
		"situation": "Brexit negotiations"
	},
	{
		"type": "Currency",
		"name": "AUD",
		"situation": "Trend"
	},
	{
		"type": "Currency",
		"name": "CHF",
		"situation": "Pattern"
	},
		{
		"type": "Currency",
		"name": "GBP",
		"situation": "Brexit news"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Parliment desition"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "US FED statement"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Interest rate change"
	},
	{
		"type": "Stock",
		"name": "AAPL",
		"situation": "Earnings"
	},
	{
		"type": "Currency",
		"name": "EUR",
		"situation": "Brexit negotiations"
	},
	{
		"type": "Currency",
		"name": "AUD",
		"situation": "Trend"
	},
	{
		"type": "Currency",
		"name": "CHF",
		"situation": "Pattern"
	},
		{
		"type": "Currency",
		"name": "GBP",
		"situation": "Brexit news"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Parliment desition"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "US FED statement"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Interest rate change"
	},
	{
		"type": "Stock",
		"name": "AAPL",
		"situation": "Earnings"
	},
	{
		"type": "Currency",
		"name": "EUR",
		"situation": "Brexit negotiations"
	},
	{
		"type": "Currency",
		"name": "AUD",
		"situation": "Trend"
	},
	{
		"type": "Currency",
		"name": "CHF",
		"situation": "Pattern"
	},
		{
		"type": "Currency",
		"name": "GBP",
		"situation": "Brexit news"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Parliment desition"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "US FED statement"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Interest rate change"
	},
	{
		"type": "Stock",
		"name": "AAPL",
		"situation": "Earnings"
	},
	{
		"type": "Currency",
		"name": "EUR",
		"situation": "Brexit negotiations"
	},
	{
		"type": "Currency",
		"name": "AUD",
		"situation": "Trend"
	},
	{
		"type": "Currency",
		"name": "CHF",
		"situation": "Pattern"
	},
		{
		"type": "Currency",
		"name": "GBP",
		"situation": "Brexit news"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Parliment desition"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "US FED statement"
	},
	{
		"type": "Currency",
		"name": "GBP",
		"situation": "Interest rate change"
	},
	{
		"type": "Stock",
		"name": "AAPL",
		"situation": "Earnings"
	},
	{
		"type": "Currency",
		"name": "EUR",
		"situation": "Brexit negotiations"
	},
	{
		"type": "Currency",
		"name": "AUD",
		"situation": "Trend"
	},
	{
		"type": "Currency",
		"name": "CHF",
		"situation": "Pattern"
	}

]

function CreateTableFromJSON(data){
    var col = [];
    for (var i = 0; i < data.length; i++) {
        for (var key in data[i]) {
            if (col.indexOf(key) === -1) {
                col.push(key);
            }
        }
    }

	var table = document.getElementById("dtVerticalScrollTableFindScenario");
	for (var i = 0; i < data.length; i++) {
            tr = table.insertRow(-1);
            for (var j = 0; j < col.length; j++) {
                var tabCell = tr.insertCell(-1);
                tabCell.innerHTML = data[i][col[j]];
            }
        }
};

CreateTableFromJSON(scenarios);


$(document).ready(function () {
	$('#dtVerticalScrollTableFindScenario').DataTable({
	"scrollY": "320px",
	"scrollCollapse": true,
	"paging": false
	});
	$('.dataTables_length').addClass('bs-select');
});


$("#dtVerticalScrollTableFindScenario tr").click(function(){
   $(this).addClass('selected').siblings().removeClass('selected');    
   var value=$(this).find('td:first').html();
   alert(value);    
});

$('.ok').on('click', function(e){
    alert($("#dtVerticalScrollTableFindScenario tr.selected td:first").html());
});

</script>

<style>
	body{
background:
radial-gradient(black 15%, transparent 16%) 0 0,
radial-gradient(black 15%, transparent 16%) 8px 8px,
radial-gradient(rgba(255,255,255,.1) 15%, transparent 20%) 0 1px,
radial-gradient(rgba(255,255,255,.1) 15%, transparent 20%) 8px 9px;
background-color:#282828;
background-size:16px 16px;
	}
</style>